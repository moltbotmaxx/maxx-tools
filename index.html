<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BCCR FX Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--bg:#0b1020;--card:#121a30;--stroke:#233056;--text:#e8ecff;--muted:#9fb0de}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:max(12px,env(safe-area-inset-top)) 12px max(16px,env(safe-area-inset-bottom));-webkit-font-smoothing:antialiased}
    .wrap{max-width:1000px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:14px;padding:12px}
    .muted{color:var(--muted);font-size:12px;line-height:1.35}
    h1{margin:2px 0 10px;font-size:clamp(22px,6vw,30px);line-height:1.1}
    h3{margin:0 0 8px;font-size:15px}
    .v{font-size:clamp(20px,5.2vw,28px);font-weight:700;letter-spacing:-0.02em}
    a{color:#8fb4ff;text-decoration:none}
    a:hover{text-decoration:underline}
    ul{padding-left:18px;margin:0}
    li{margin:0 0 10px;line-height:1.35}
    #trend{height:220px !important}

    @media (max-width: 900px){
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width: 430px){
      body{padding-left:10px;padding-right:10px}
      .card{padding:11px}
      .grid{gap:8px}
      #trend{height:200px !important}
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>ðŸ‡¨ðŸ‡· BCCR FX Tracker</h1>
  <p class="muted">Fuente primaria: BCCR (webservice oficial). ActualizaciÃ³n automÃ¡tica con GitHub Actions.</p>
  <div class="grid" id="cards"></div>
  <div class="card" style="margin-top:12px">
    <h3>Tendencia (Ãºltimos 30 puntos)</h3>
    <canvas id="trend"></canvas>
  </div>
  <div class="card" style="margin-top:12px">
    <h3>Noticias oficiales / intervenciones</h3>
    <ul id="news"></ul>
  </div>
</div>
<script>
(async()=>{
  const res = await fetch('./data/latest.json?_=' + Date.now());
  const data = await res.json();
  const cards = document.getElementById('cards');
  const money = n => n==null?'N/D':new Intl.NumberFormat('es-CR',{minimumFractionDigits:2,maximumFractionDigits:2}).format(n);
  const items = [
    ['USD Compra', data.usd?.buy, data.usd?.buyChange],
    ['USD Venta', data.usd?.sell, data.usd?.sellChange],
    ['EUR Compra', data.eur?.buy, data.eur?.buyChange],
    ['EUR Venta', data.eur?.sell, data.eur?.sellChange],
  ];
  cards.innerHTML = items.map(([t,v,c])=>`<div class="card"><div class="muted">${t}</div><div class="v">â‚¡ ${money(v)}</div><div class="muted">Î” ${c==null?'N/D':c.toFixed(2)}</div></div>`).join('');

  const labels = (data.history||[]).map(x=>x.date);
  const usd = (data.history||[]).map(x=>x.usdSell ?? null);
  const eur = (data.history||[]).map(x=>x.eurSell ?? null);
  new Chart(document.getElementById('trend'), {
    type:'line',
    data:{labels,datasets:[{label:'USD Venta',data:usd,borderColor:'#60a5fa'},{label:'EUR Venta',data:eur,borderColor:'#34d399'}]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#dbe4ff'}}},scales:{x:{ticks:{color:'#a9b8e6'}},y:{ticks:{color:'#a9b8e6'}}}}
  });

  const news = document.getElementById('news');
  news.innerHTML = (data.news||[]).slice(0,10).map(n=>`<li><a href="${n.url}" target="_blank">${n.title}</a> <span class="muted">(${n.date||''})</span></li>`).join('') || '<li>No hay noticias aÃºn.</li>';
})();
</script>
</body>
</html>