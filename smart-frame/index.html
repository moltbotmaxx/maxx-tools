<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Frame Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Sora:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f6f4ef;
      --panel: #fffcf5;
      --panel-alt: #f0ede4;
      --ink: #181714;
      --muted: #6d665b;
      --line: #d7d0c3;
      --accent: #206c4f;
      --accent-soft: #d7f0e5;
      --warm: #b85f2f;
      --ok: #2f7a3f;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(36, 28, 14, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      width: 1024px;
      height: 640px;
      overflow: hidden;
      background: radial-gradient(circle at 15% 0%, #fff8df 0%, var(--bg) 38%, #ebe7dc 100%);
      color: var(--ink);
    }

    body {
      font-family: "Space Grotesk", sans-serif;
      padding: 14px;
    }

    .frame {
      width: 100%;
      height: 100%;
      border: 1px solid var(--line);
      border-radius: 24px;
      background: linear-gradient(180deg, #fffdf7 0%, #f6f2e8 100%);
      box-shadow: var(--shadow);
      display: grid;
      grid-template-rows: 54px 1fr 34px;
      overflow: hidden;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-bottom: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.6);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .brand-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: conic-gradient(from 45deg, #1f6f52, #d5a44f, #b85f2f, #1f6f52);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .meta {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--muted);
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--panel-alt);
      border: 1px solid var(--line);
      font-weight: 600;
    }

    .clock {
      font-family: "Sora", sans-serif;
      font-weight: 700;
      font-size: 15px;
      color: var(--ink);
      min-width: 48px;
      text-align: right;
    }

    .grid {
      display: grid;
      grid-template-columns: 320px 1fr 250px;
      grid-template-rows: 1fr 1fr;
      gap: 10px;
      padding: 10px;
      min-height: 0;
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      display: flex;
      flex-direction: column;
      min-width: 0;
      min-height: 0;
      overflow: hidden;
    }

    .card-head {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      font-weight: 700;
    }

    .icon {
      width: 22px;
      height: 22px;
      display: grid;
      place-items: center;
      border-radius: 8px;
      background: var(--panel-alt);
      font-size: 13px;
    }

    .card-body {
      flex: 1;
      min-height: 0;
      padding: 0 12px 12px;
    }

    .weather {
      grid-row: 1 / span 2;
      position: relative;
      color: #fff;
      isolation: isolate;
    }

    .weather::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(8, 26, 45, 0.2) 10%, rgba(8, 26, 45, 0.75) 100%);
      z-index: 1;
    }

    .weather-bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .weather .card-head,
    .weather .card-body {
      position: relative;
      z-index: 2;
    }

    .weather .card-head {
      color: rgba(255, 255, 255, 0.86);
      padding-top: 12px;
    }

    .weather .icon {
      background: rgba(255, 255, 255, 0.2);
    }

    .weather-main {
      display: grid;
      gap: 4px;
      text-align: center;
      margin-top: 8px;
    }

    .weather-temp {
      font-family: "Sora", sans-serif;
      font-size: 86px;
      line-height: 0.9;
      letter-spacing: -0.05em;
      font-weight: 800;
    }

    .weather-desc {
      font-size: 15px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.88);
    }

    .weather-stats {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }

    .mini {
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.12);
      padding: 7px;
      text-align: center;
      backdrop-filter: blur(8px);
    }

    .mini-k {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 700;
    }

    .mini-v {
      margin-top: 3px;
      font-size: 15px;
      font-weight: 700;
    }

    .hourly {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 5px;
    }

    .hour {
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.12);
      padding: 6px 4px;
      text-align: center;
    }

    .hour-time {
      font-size: 9px;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.72);
      font-weight: 700;
      letter-spacing: 0.06em;
    }

    .hour-icon {
      font-size: 15px;
      margin: 2px 0;
    }

    .hour-temp {
      font-size: 12px;
      font-weight: 700;
    }

    .agent .card-body {
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 10px;
    }

    .agent-id {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid var(--line);
    }

    .agent-name {
      font-size: 14px;
      font-weight: 700;
      line-height: 1.2;
    }

    .agent-model {
      margin-top: 2px;
      font-size: 11px;
      color: var(--muted);
    }

    .logic {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      width: fit-content;
      padding: 5px 9px;
      border-radius: 10px;
      border: 1px solid #b9dccc;
      background: var(--accent-soft);
      color: #0f5b3e;
      font-size: 11px;
      font-weight: 700;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #24a866;
      animation: pulse 1.8s infinite;
    }

    .agent-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      align-content: start;
    }

    .stat {
      background: var(--panel-alt);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 7px 9px;
    }

    .stat-k {
      font-size: 9px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 700;
    }

    .stat-v {
      margin-top: 2px;
      font-size: 13px;
      font-weight: 700;
      color: var(--ink);
    }

    .bar {
      height: 4px;
      border-radius: 999px;
      background: #cbc4b7;
      margin-top: 5px;
      overflow: hidden;
    }

    .bar > span {
      display: block;
      height: 100%;
      width: 0;
      border-radius: inherit;
      background: var(--accent);
      transition: width .3s ease;
    }

    .instagram .card-body {
      display: grid;
      grid-template-rows: auto auto auto;
      gap: 8px;
      min-height: 0;
      align-content: start;
    }

    .handle {
      font-size: 14px;
      font-weight: 700;
    }

    .followers {
      display: flex;
      align-items: baseline;
      gap: 7px;
    }

    .followers strong {
      font-family: "Sora", sans-serif;
      font-size: 30px;
      line-height: 1;
      letter-spacing: -0.04em;
    }

    .growth {
      font-size: 12px;
      color: var(--ok);
      font-weight: 700;
    }

    .ig-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }

    .news {
      grid-column: 2 / 4;
    }

    .news .card-body {
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 8px;
      min-height: 0;
    }

    .featured {
      display: grid;
      grid-template-columns: 110px 1fr;
      gap: 10px;
      min-height: 0;
    }

    .featured img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: var(--panel-alt);
      min-height: 84px;
    }

    .tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: #f0d8c7;
      color: #7c3f1f;
      margin-bottom: 5px;
    }

    .headline {
      font-size: 14px;
      font-weight: 700;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .source {
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .secondary {
      border: 1px solid var(--line);
      border-radius: 10px;
      overflow: hidden;
      background: var(--panel-alt);
    }

    .secondary-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 9px;
      font-size: 11px;
      min-width: 0;
    }

    .secondary-item + .secondary-item {
      border-top: 1px solid var(--line);
    }

    .secondary-item .pin {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--warm);
      flex-shrink: 0;
    }

    .secondary-item .text {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: #373228;
      font-weight: 600;
    }

    .secondary-item .time {
      margin-left: auto;
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #d7f0e5;
      border: 1px solid #b9dccc;
      color: #0f5b3e;
      font-weight: 700;
      flex-shrink: 0;
    }

    .bottombar {
      border-top: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 14px;
      font-size: 11px;
      color: var(--muted);
      background: rgba(255, 255, 255, 0.4);
    }

    .channels {
      display: flex;
      gap: 6px;
    }

    .ch {
      border: 1px solid var(--line);
      background: var(--panel);
      padding: 2px 7px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
    }

    .ch::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #27a25e;
      box-shadow: 0 0 0 2px rgba(39, 162, 94, 0.2);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.35; }
    }
  </style>
</head>
<body>
  <main class="frame">
    <header class="topbar">
      <div class="brand">
        <span class="brand-dot"></span>
        <span>Smart Frame</span>
      </div>
      <div class="meta">
        <span class="badge" id="topbar-date">-</span>
        <span class="clock" id="topbar-time">--:--</span>
      </div>
    </header>

    <section class="grid">
      <article class="card weather">
        <img class="weather-bg" id="weather-bg-img" src="" alt="Fondo clima">
        <div class="card-head">
          <span class="icon" id="weather-header-icon">-</span>
          <span>Clima</span>
          <span style="margin-left:auto" id="weather-time">-</span>
        </div>
        <div class="card-body">
          <div class="weather-main">
            <div class="weather-temp"><span id="weather-temp">-</span>&deg;</div>
            <div class="weather-desc" id="weather-desc">-</div>
          </div>
          <div class="weather-stats">
            <div class="mini">
              <div class="mini-k">Viento</div>
              <div class="mini-v" id="weather-wind">-</div>
            </div>
            <div class="mini">
              <div class="mini-k">Humedad</div>
              <div class="mini-v" id="weather-humidity">-</div>
            </div>
            <div class="mini">
              <div class="mini-k">UV</div>
              <div class="mini-v" id="weather-uv">-</div>
            </div>
          </div>
          <div class="hourly" id="weather-hourly"></div>
        </div>
      </article>

      <article class="card agent">
        <div class="card-head">
          <span class="icon">ðŸ¤–</span>
          <span>OpenClaw</span>
          <span style="margin-left:auto" id="moltbot-logic">-</span>
        </div>
        <div class="card-body">
          <div class="agent-id">
            <img class="avatar" src="maxx_avatar_real.png" alt="Maxx">
            <div>
              <div class="agent-name" id="moltbot-name">-</div>
              <div class="agent-model" id="moltbot-model">-</div>
            </div>
          </div>
          <div class="logic"><span class="dot"></span><span id="moltbot-mood">-</span></div>
          <div class="agent-stats">
            <div class="stat">
              <div class="stat-k">Contexto</div>
              <div class="stat-v" id="moltbot-context">-</div>
              <div class="bar"><span id="moltbot-context-bar"></span></div>
            </div>
            <div class="stat">
              <div class="stat-k">Tokens</div>
              <div class="stat-v" id="moltbot-tokens">-</div>
            </div>
            <div class="stat">
              <div class="stat-k">Progreso</div>
              <div class="stat-v" id="moltbot-goals">-</div>
            </div>
            <div class="stat">
              <div class="stat-k">ETA</div>
              <div class="stat-v" id="moltbot-eta">-</div>
            </div>
          </div>
        </div>
      </article>

      <article class="card instagram">
        <div class="card-head">
          <span class="icon">ðŸ“·</span>
          <span>Instagram</span>
        </div>
        <div class="card-body">
          <div class="handle" id="ig-handle">-</div>
          <div class="followers">
            <strong id="ig-followers">-</strong>
            <span class="growth" id="ig-growth">-</span>
          </div>
          <div class="ig-metrics">
            <div class="stat">
              <div class="stat-k">Posts</div>
              <div class="stat-v" id="ig-posts">-</div>
            </div>
            <div class="stat">
              <div class="stat-k">Engagement</div>
              <div class="stat-v" id="ig-engagement">-</div>
            </div>
          </div>
        </div>
      </article>

      <article class="card news">
        <div class="card-head">
          <span class="icon">ðŸ“°</span>
          <span>Noticias</span>
        </div>
        <div class="card-body">
          <div class="featured">
            <img id="news-img" src="" alt="Imagen noticia">
            <div>
              <span class="tag" id="news-tag">-</span>
              <div class="headline" id="news-headline">-</div>
              <div class="source" id="news-source">-</div>
            </div>
          </div>
          <div class="secondary" id="news-secondary"></div>
        </div>
      </article>
    </section>

    <footer class="bottombar">
      <div class="channels">
        <span class="ch">Telegram</span>
        <span class="ch">WhatsApp</span>
      </div>
      <span id="frame-id">FID:-</span>
    </footer>
  </main>

  <script>
    const BASE = "./";

    async function loadJSON(file) {
      try {
        const res = await fetch(BASE + file + "?t=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error(String(res.status));
        return await res.json();
      } catch (err) {
        console.warn("No se pudo cargar", file, err);
        return null;
      }
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? "-";
    }

    function setImage(id, src) {
      const el = document.getElementById(id);
      if (el && typeof src === "string" && src.trim()) el.src = src;
    }

    function escapeHtml(value) {
      return String(value ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function clampText(text, max = 120) {
      const raw = String(text ?? "");
      if (raw.length <= max) return raw;
      return raw.slice(0, max - 1) + "â€¦";
    }

    async function updateWeather() {
      const data = await loadJSON("weather.json");
      const w = data?.weather;
      if (!w) return;

      setText("weather-temp", w.temp_c);
      setText("weather-desc", w.condition);
      setText("weather-wind", w.wind_kmh ? `${w.wind_kmh} km/h` : "-");
      setText("weather-humidity", w.humidity ? `${w.humidity}%` : "-");
      setText("weather-uv", w.uv_index);
      setText("weather-time", w.last_updated);
      setText("weather-header-icon", w.icon || "â˜€ï¸");
      setImage("weather-bg-img", w.bg_image);

      const hourlyRoot = document.getElementById("weather-hourly");
      if (hourlyRoot) {
        const items = Array.isArray(w.hourly_forecast) ? w.hourly_forecast.slice(0, 4) : [];
        if (!items.length) {
          hourlyRoot.innerHTML = [
            { time: "Now", icon: w.icon || "â˜€ï¸", temp: w.temp_c || "-" },
            { time: "+1h", icon: "â›…", temp: w.temp_c || "-" },
            { time: "+2h", icon: "ðŸŒ¤", temp: w.temp_c || "-" },
            { time: "+3h", icon: "ðŸŒ™", temp: w.temp_c || "-" }
          ].map((item) => `
            <div class="hour">
              <div class="hour-time">${escapeHtml(item.time)}</div>
              <div class="hour-icon">${escapeHtml(item.icon)}</div>
              <div class="hour-temp">${escapeHtml(item.temp)}&deg;</div>
            </div>
          `).join("");
          return;
        }

        hourlyRoot.innerHTML = items.map((item) => `
          <div class="hour">
            <div class="hour-time">${escapeHtml(item.time)}</div>
            <div class="hour-icon">${escapeHtml(item.icon || "â€¢")}</div>
            <div class="hour-temp">${escapeHtml(item.temp)}&deg;</div>
          </div>
        `).join("");
      }
    }

    async function updateMoltbot() {
      const [moltData, frameData] = await Promise.all([loadJSON("moltbot.json"), loadJSON("data.json")]);
      const m = moltData?.moltbot;
      if (!m) return;

      setText("moltbot-name", frameData?.maxx_status?.label || "Maxx Moltbot");
      setText("moltbot-model", m.system?.current_model || "-");
      setText("moltbot-mood", m.state?.system_mood || "-");
      setText("moltbot-context", m.system?.context_usage || "-");
      setText("moltbot-tokens", m.system?.token_usage_daily || "-");
      setText("moltbot-goals", m.operations?.daily_goal_progress || "-");
      setText("moltbot-eta", m.operations?.next_post_eta || "-");
      setText("moltbot-logic", m.state?.logic_mode || "-");

      const bar = document.getElementById("moltbot-context-bar");
      if (bar) {
        const pctRaw = parseInt(String(m.system?.context_usage || "0"), 10);
        const pct = Number.isNaN(pctRaw) ? 0 : Math.max(0, Math.min(100, pctRaw));
        bar.style.width = `${pct}%`;
      }
    }

    async function updateInstagram() {
      const data = await loadJSON("instagram.json");
      const ig = data?.instagram;
      if (!ig) return;

      setText("ig-handle", ig.username);
      setText("ig-followers", ig.followers);
      setText("ig-growth", ig.growth);
      setText("ig-posts", ig.posts);
      setText("ig-engagement", ig.engagement_rate);
    }

    async function updateNews() {
      const data = await loadJSON("news.json");
      const n = data?.news;
      if (!n) return;

      setText("news-tag", n.featured?.tag || "Latest");
      setText("news-headline", n.featured?.headline || "-");
      setText("news-source", n.featured?.source || "-");
      setImage("news-img", n.featured?.image_url);

      const root = document.getElementById("news-secondary");
      if (!root) return;

      const items = [n.secondary_1, n.secondary_2].filter(Boolean);
      root.innerHTML = items.map((item) => `
        <div class="secondary-item">
          <span class="pin"></span>
          <span class="text">${escapeHtml(clampText(item.headline, 98))}</span>
          <span class="time">${escapeHtml(item.time || "Now")}</span>
        </div>
      `).join("");
    }

    async function updateMeta() {
      const data = await loadJSON("data.json");
      const s = data?.maxx_status;
      if (!s) return;
      setText("topbar-date", s.date || "-");
      setText("frame-id", `FID:${s.frame_id || "-"}`);
    }

    function updateClock() {
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      setText("topbar-time", `${hh}:${mm}`);
    }

    async function refresh() {
      await Promise.all([
        updateWeather(),
        updateMoltbot(),
        updateInstagram(),
        updateNews(),
        updateMeta()
      ]);
      updateClock();
    }

    refresh();
    setInterval(refresh, 30 * 60 * 1000);
    setInterval(updateClock, 30 * 1000);
  </script>
</body>
</html>
