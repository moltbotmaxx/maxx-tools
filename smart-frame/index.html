<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Frame Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Sora:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #ece8df;
      --panel: #fffdf7;
      --panel-2: #f2ece0;
      --ink: #191715;
      --muted: #6e665a;
      --line: #d3cabc;
      --accent: #1f694d;
      --accent-2: #b86433;
      --ok: #2f7d47;
      --radius: 16px;
      --shadow: 0 10px 24px rgba(21, 17, 10, 0.12);
    }

    * { box-sizing: border-box; }

    html,
    body {
      width: 1024px;
      height: 640px;
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at 12% -10%, #fff8db 0%, #f1ede3 35%, #e5ded1 100%);
      color: var(--ink);
    }

    body {
      padding: 10px;
      font-family: "Space Grotesk", sans-serif;
    }

    .frame {
      height: 100%;
      border: 1px solid var(--line);
      border-radius: 20px;
      background: linear-gradient(180deg, #fffef9 0%, #f4efe4 100%);
      box-shadow: var(--shadow);
      display: grid;
      grid-template-rows: 54px 1fr 34px;
      overflow: hidden;
    }

    .topbar,
    .bottombar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 14px;
      border-color: var(--line);
      background: rgba(255, 255, 255, 0.6);
    }

    .topbar { border-bottom: 1px solid var(--line); }
    .bottombar { border-top: 1px solid var(--line); }

    .brand {
      display: flex;
      align-items: center;
      gap: 9px;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .brand-mark {
      width: 24px;
      height: 24px;
      border-radius: 8px;
      background: linear-gradient(145deg, #206b4e, #b86433);
      color: #fff;
      display: grid;
      place-items: center;
      font-size: 13px;
    }

    .meta {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--muted);
    }

    .pill {
      border: 1px solid var(--line);
      border-radius: 999px;
      background: var(--panel-2);
      font-weight: 700;
      padding: 4px 10px;
    }

    .clock {
      font-family: "Sora", sans-serif;
      font-size: 14px;
      font-weight: 800;
      min-width: 46px;
      text-align: right;
      color: var(--ink);
    }

    .dashboard {
      display: grid;
      grid-template-columns: 320px 1fr 260px;
      grid-template-rows: 224px 1fr;
      gap: 8px;
      padding: 8px;
      min-height: 0;
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      min-width: 0;
      min-height: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .head {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 10px 6px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      font-weight: 700;
    }

    .icon {
      width: 22px;
      height: 22px;
      border-radius: 8px;
      display: grid;
      place-items: center;
      background: var(--panel-2);
      font-size: 13px;
    }

    .head-right { margin-left: auto; }

    .body {
      flex: 1;
      min-height: 0;
      padding: 0 10px 10px;
    }

    .weather {
      grid-row: 1 / 3;
      position: relative;
      color: #fff;
      isolation: isolate;
    }

    .weather-bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .weather::before {
      content: "";
      position: absolute;
      inset: 0;
      z-index: 1;
      background: linear-gradient(180deg, rgba(4, 19, 35, 0.2) 8%, rgba(4, 19, 35, 0.84) 100%);
    }

    .weather .head,
    .weather .body {
      z-index: 2;
      position: relative;
    }

    .weather .icon { background: rgba(255, 255, 255, 0.2); }

    .weather-main {
      display: grid;
      grid-template-rows: auto auto;
      justify-items: center;
      margin-top: 8px;
      gap: 4px;
    }

    .weather-temp {
      font-family: "Sora", sans-serif;
      font-size: 82px;
      line-height: 0.9;
      letter-spacing: -0.05em;
      font-weight: 800;
    }

    .weather-desc {
      font-size: 14px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.9);
    }

    .weather-stats {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }

    .chip {
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      text-align: center;
      padding: 7px 5px;
      backdrop-filter: blur(6px);
    }

    .chip-k {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.74);
    }

    .chip-v {
      margin-top: 3px;
      font-size: 14px;
      font-weight: 800;
    }

    .hourly {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
    }

    .hour {
      text-align: center;
      padding: 5px 4px;
      border-radius: 9px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.11);
    }

    .hour-time {
      font-size: 9px;
      color: rgba(255, 255, 255, 0.72);
      font-weight: 700;
      text-transform: uppercase;
    }

    .hour-icon { font-size: 14px; margin: 1px 0; }
    .hour-temp { font-size: 12px; font-weight: 700; }

    .agent .body {
      display: grid;
      grid-template-rows: auto auto auto 1fr;
      gap: 8px;
      align-content: start;
    }

    .agent-id {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .avatar {
      width: 42px;
      height: 42px;
      border-radius: 11px;
      border: 1px solid var(--line);
      object-fit: cover;
      flex-shrink: 0;
    }

    .agent-name { font-size: 14px; font-weight: 700; line-height: 1.2; }
    .agent-model { margin-top: 2px; font-size: 11px; color: var(--muted); }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      width: fit-content;
      border: 1px solid #b8d8ca;
      background: #dbf2e8;
      color: #11573b;
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 11px;
      font-weight: 700;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #23a161;
      animation: pulse 1.8s infinite;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }

    .stat {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 7px 8px;
      background: var(--panel-2);
      min-height: 55px;
    }

    .stat-k {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      font-weight: 700;
    }

    .stat-v {
      margin-top: 2px;
      font-size: 13px;
      font-weight: 700;
      color: var(--ink);
      line-height: 1.25;
    }

    .bar {
      margin-top: 4px;
      height: 4px;
      border-radius: 99px;
      background: #cbc3b6;
      overflow: hidden;
    }

    .bar > span {
      display: block;
      height: 100%;
      width: 0;
      border-radius: inherit;
      background: var(--accent);
      transition: width 0.3s ease;
    }

    .agent-foot {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #f6f2e9;
      padding: 7px 8px;
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 7px;
      align-items: start;
      min-height: 0;
    }

    .agent-foot-icon {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      background: #eadfce;
      color: #8a532c;
      display: grid;
      place-items: center;
      font-size: 11px;
      font-weight: 800;
    }

    .agent-foot-text {
      font-size: 11px;
      color: #4b463e;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .instagram .body {
      display: grid;
      grid-template-rows: auto auto auto 1fr;
      gap: 7px;
      min-height: 0;
    }

    .handle {
      font-size: 13px;
      font-weight: 700;
      color: #2f2a23;
      line-height: 1.2;
    }

    .followers {
      display: flex;
      align-items: baseline;
      gap: 7px;
    }

    .followers strong {
      font-family: "Sora", sans-serif;
      font-size: 30px;
      line-height: 1;
      letter-spacing: -0.04em;
    }

    .growth {
      font-size: 11px;
      color: var(--ok);
      font-weight: 700;
    }

    .ig-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }

    .ig-extra {
      display: grid;
      grid-template-rows: auto auto;
      gap: 6px;
      min-height: 0;
    }

    .ig-line {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: var(--panel-2);
      padding: 7px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-width: 0;
    }

    .ig-line-k {
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      flex-shrink: 0;
    }

    .ig-line-v {
      font-size: 11px;
      font-weight: 700;
      color: #3a352d;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      max-width: 130px;
    }

    .news {
      grid-column: 2 / 4;
    }

    .news .body {
      display: grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
      gap: 8px;
      min-height: 0;
    }

    .featured {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--panel-2);
      padding: 8px;
      display: grid;
      grid-template-columns: 168px 1fr;
      gap: 8px;
      min-height: 0;
    }

    .featured img {
      width: 100%;
      height: 100%;
      min-height: 148px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid #cfc5b7;
      background: #e8e1d5;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #e2b696;
      background: #f4dbc8;
      color: #7f431e;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 5px;
    }

    .headline {
      font-size: 16px;
      line-height: 1.32;
      font-weight: 700;
      color: #23201b;
      display: -webkit-box;
      -webkit-line-clamp: 4;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .source {
      margin-top: 8px;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
    }

    .secondary {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--panel-2);
      padding: 6px;
      display: grid;
      grid-auto-rows: 1fr;
      gap: 6px;
      min-height: 0;
    }

    .secondary-item {
      border: 1px solid #d4cabc;
      border-radius: 10px;
      background: #fbf7ef;
      padding: 8px;
      display: grid;
      grid-template-columns: 8px 1fr auto;
      align-items: center;
      gap: 7px;
      min-width: 0;
    }

    .pin {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-2);
      box-shadow: 0 0 0 3px rgba(184, 100, 51, 0.18);
    }

    .text {
      font-size: 12px;
      line-height: 1.3;
      color: #383329;
      font-weight: 700;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .time {
      font-size: 10px;
      font-weight: 700;
      color: #0f5b3e;
      background: #dbf2e8;
      border: 1px solid #badbcc;
      border-radius: 999px;
      padding: 2px 7px;
      white-space: nowrap;
    }

    .channels {
      display: flex;
      gap: 6px;
    }

    .ch {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: var(--panel);
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      padding: 2px 8px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .ch::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #23a161;
      box-shadow: 0 0 0 2px rgba(35, 161, 97, 0.2);
    }

    .fid {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.06em;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.35; }
    }
  </style>
</head>
<body>
  <main class="frame">
    <header class="topbar">
      <div class="brand">
        <span class="brand-mark">SF</span>
        <span>Smart Frame Board</span>
      </div>
      <div class="meta">
        <span class="pill" id="topbar-date">-</span>
        <span class="clock" id="topbar-time">--:--</span>
      </div>
    </header>

    <section class="dashboard">
      <article class="card weather">
        <img class="weather-bg" id="weather-bg-img" src="" alt="Fondo clima">
        <div class="head">
          <span class="icon" id="weather-header-icon">-</span>
          <span>Clima</span>
          <span class="head-right" id="weather-time">-</span>
        </div>
        <div class="body">
          <div class="weather-main">
            <div class="weather-temp"><span id="weather-temp">-</span>&deg;</div>
            <div class="weather-desc" id="weather-desc">-</div>
          </div>
          <div class="weather-stats">
            <div class="chip">
              <div class="chip-k">Viento</div>
              <div class="chip-v" id="weather-wind">-</div>
            </div>
            <div class="chip">
              <div class="chip-k">Humedad</div>
              <div class="chip-v" id="weather-humidity">-</div>
            </div>
            <div class="chip">
              <div class="chip-k">UV</div>
              <div class="chip-v" id="weather-uv">-</div>
            </div>
          </div>
          <div class="hourly" id="weather-hourly"></div>
        </div>
      </article>

      <article class="card agent">
        <div class="head">
          <span class="icon">AI</span>
          <span>OpenClaw</span>
          <span class="head-right" id="moltbot-logic">-</span>
        </div>
        <div class="body">
          <div class="agent-id">
            <img class="avatar" src="maxx_avatar_real.png" alt="Maxx">
            <div>
              <div class="agent-name" id="moltbot-name">-</div>
              <div class="agent-model" id="moltbot-model">-</div>
            </div>
          </div>
          <div class="status"><span class="status-dot"></span><span id="moltbot-mood">-</span></div>
          <div class="stats-grid">
            <div class="stat">
              <div class="stat-k">Contexto</div>
              <div class="stat-v" id="moltbot-context">-</div>
              <div class="bar"><span id="moltbot-context-bar"></span></div>
            </div>
            <div class="stat">
              <div class="stat-k">Tokens</div>
              <div class="stat-v" id="moltbot-tokens">-</div>
            </div>
            <div class="stat">
              <div class="stat-k">Progreso</div>
              <div class="stat-v" id="moltbot-goals">-</div>
            </div>
            <div class="stat">
              <div class="stat-k">ETA</div>
              <div class="stat-v" id="moltbot-eta">-</div>
            </div>
          </div>
          <div class="agent-foot">
            <span class="agent-foot-icon">!</span>
            <div class="agent-foot-text" id="moltbot-last-action">Sin actividad reciente.</div>
          </div>
        </div>
      </article>

      <article class="card instagram">
        <div class="head">
          <span class="icon">IG</span>
          <span>Instagram</span>
        </div>
        <div class="body">
          <div class="handle" id="ig-handle">-</div>
          <div class="followers">
            <strong id="ig-followers">-</strong>
            <span class="growth" id="ig-growth">-</span>
          </div>
          <div class="ig-metrics">
            <div class="stat">
              <div class="stat-k">Posts</div>
              <div class="stat-v" id="ig-posts">-</div>
            </div>
            <div class="stat">
              <div class="stat-k">Engagement</div>
              <div class="stat-v" id="ig-engagement">-</div>
            </div>
          </div>
          <div class="ig-extra">
            <div class="ig-line">
              <span class="ig-line-k">Ultimo Post</span>
              <span class="ig-line-v" id="ig-last-post-time">-</span>
            </div>
            <div class="ig-line">
              <span class="ig-line-k">Objetivo Diario</span>
              <span class="ig-line-v" id="ig-daily-goal">-</span>
            </div>
          </div>
        </div>
      </article>

      <article class="card news">
        <div class="head">
          <span class="icon">N</span>
          <span>Newsroom</span>
        </div>
        <div class="body">
          <div class="featured">
            <img id="news-img" src="" alt="Imagen noticia">
            <div>
              <span class="tag" id="news-tag">-</span>
              <div class="headline" id="news-headline">-</div>
              <div class="source" id="news-source">-</div>
            </div>
          </div>
          <div class="secondary" id="news-secondary"></div>
        </div>
      </article>
    </section>

    <footer class="bottombar">
      <div class="channels">
        <span class="ch">Telegram</span>
        <span class="ch">WhatsApp</span>
      </div>
      <span class="fid" id="frame-id">FID:-</span>
    </footer>
  </main>

  <script>
    const BASE = "./";

    async function loadJSON(file) {
      try {
        const res = await fetch(BASE + file + "?t=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error(String(res.status));
        return await res.json();
      } catch (err) {
        console.warn("No se pudo cargar", file, err);
        return null;
      }
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? "-";
    }

    function setImage(id, src) {
      const el = document.getElementById(id);
      if (el && typeof src === "string" && src.trim()) el.src = src;
    }

    function escapeHtml(value) {
      return String(value ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function clampText(text, max = 120) {
      const raw = String(text ?? "");
      if (raw.length <= max) return raw;
      return raw.slice(0, max - 1) + "...";
    }

    async function updateWeather() {
      const data = await loadJSON("weather.json");
      const w = data?.weather;
      if (!w) return;

      setText("weather-temp", w.temp_c);
      setText("weather-desc", w.condition);
      setText("weather-wind", w.wind_kmh ? `${w.wind_kmh} km/h` : "-");
      setText("weather-humidity", w.humidity ? `${w.humidity}%` : "-");
      setText("weather-uv", w.uv_index);
      setText("weather-time", w.last_updated);
      setText("weather-header-icon", w.icon || "*");
      setImage("weather-bg-img", w.bg_image);

      const hourlyRoot = document.getElementById("weather-hourly");
      if (!hourlyRoot) return;

      const items = Array.isArray(w.hourly_forecast) ? w.hourly_forecast.slice(0, 4) : [];
      const fallback = [
        { time: "Now", icon: w.icon || "*", temp: w.temp_c || "-" },
        { time: "+1h", icon: ".", temp: w.temp_c || "-" },
        { time: "+2h", icon: ".", temp: w.temp_c || "-" },
        { time: "+3h", icon: ".", temp: w.temp_c || "-" }
      ];

      const renderItems = items.length ? items : fallback;
      hourlyRoot.innerHTML = renderItems.map((item) => `
        <div class="hour">
          <div class="hour-time">${escapeHtml(item.time)}</div>
          <div class="hour-icon">${escapeHtml(item.icon || "*")}</div>
          <div class="hour-temp">${escapeHtml(item.temp)}&deg;</div>
        </div>
      `).join("");
    }

    async function updateMoltbot() {
      const [moltData, frameData] = await Promise.all([loadJSON("moltbot.json"), loadJSON("data.json")]);
      const m = moltData?.moltbot;
      if (!m) return;

      setText("moltbot-name", frameData?.maxx_status?.label || "Maxx Moltbot");
      setText("moltbot-model", m.system?.current_model || "-");
      setText("moltbot-mood", m.state?.system_mood || "-");
      setText("moltbot-context", m.system?.context_usage || "-");
      setText("moltbot-tokens", m.system?.token_usage_daily || "-");
      setText("moltbot-goals", m.operations?.daily_goal_progress || "-");
      setText("moltbot-eta", m.operations?.next_post_eta || "-");
      setText("moltbot-logic", m.state?.logic_mode || "-");
      setText("moltbot-last-action", m.state?.last_action || "Sin actividad reciente.");

      const bar = document.getElementById("moltbot-context-bar");
      if (bar) {
        const pctRaw = parseInt(String(m.system?.context_usage || "0"), 10);
        const pct = Number.isNaN(pctRaw) ? 0 : Math.max(0, Math.min(100, pctRaw));
        bar.style.width = `${pct}%`;
      }
    }

    async function updateInstagram() {
      const data = await loadJSON("instagram.json");
      const ig = data?.instagram;
      if (!ig) return;

      setText("ig-handle", ig.username);
      setText("ig-followers", ig.followers);
      setText("ig-growth", ig.growth);
      setText("ig-posts", ig.posts);
      setText("ig-engagement", ig.engagement_rate);
      setText("ig-last-post-time", data?.openclaws?.last_post_timestamp || "-");
      setText("ig-daily-goal", data?.openclaws?.daily_goal_progress || "-");
    }

    async function updateNews() {
      const data = await loadJSON("news.json");
      const n = data?.news;
      if (!n) return;

      setText("news-tag", n.featured?.tag || "Latest");
      setText("news-headline", n.featured?.headline || "-");
      setText("news-source", n.featured?.source || "-");
      setImage("news-img", n.featured?.image_url);

      const root = document.getElementById("news-secondary");
      if (!root) return;

      const items = [n.secondary_1, n.secondary_2].filter(Boolean);
      root.innerHTML = items.map((item) => `
        <div class="secondary-item">
          <span class="pin"></span>
          <span class="text">${escapeHtml(clampText(item.headline, 160))}</span>
          <span class="time">${escapeHtml(item.time || "Now")}</span>
        </div>
      `).join("");
    }

    async function updateMeta() {
      const data = await loadJSON("data.json");
      const s = data?.maxx_status;
      if (!s) return;
      setText("topbar-date", s.date || "-");
      setText("frame-id", `FID:${s.frame_id || "-"}`);
    }

    function updateClock() {
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      setText("topbar-time", `${hh}:${mm}`);
    }

    async function refresh() {
      await Promise.all([
        updateWeather(),
        updateMoltbot(),
        updateInstagram(),
        updateNews(),
        updateMeta()
      ]);
      updateClock();
    }

    refresh();
    setInterval(refresh, 30 * 60 * 1000);
    setInterval(updateClock, 30 * 1000);
  </script>
</body>
</html>
